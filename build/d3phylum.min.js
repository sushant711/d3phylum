this.d3phylum={visuals:{},components:{},utils:{},_visuals:{}},d3phylum.utils={svgTranslate:function(a,b){return"translate("+a+","+b+")"},getCushionedDomainForExtent:function(a,b){var c=a[1]-a[0];c+=2*c*b;var d=c*b;return[a[0]-d,a[1]+d]},hexToRgb:function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},rgbToHex:function(a,b,c){var d=function(a){var b=a.toString(16);return 1==b.length?"0"+b:b};return"#"+d(a)+d(b)+d(c)},strSubstitute:function(a,b){return Object.keys(b).map(function(c){return a=a.replace(c,b[c]),c}),a},rgbaStr:function(a,b,c,d){return this.strSubstitute("rgba({{r}}, {{g}}, {{b}}, {{a}})",{"{{r}}":a,"{{g}}":b,"{{b}}":c,"{{a}}":d})}},d3phylum.visuals.baseChart=function(a,b){a.width=function(c){return arguments.length?(b.width=c,b.margin&&(b.width-=b.margin.left,b.width-=b.margin.right),a):b.width},a.height=function(c){return arguments.length?(b.height=c,b.margin&&(b.height-=b.margin.top||0,b.height-=b.margin.bottom||0),a):b.height},a.source=function(c){return b.source=c,a},a.axisLabels=function(c){return arguments.length?(b.axis_labels=c,a):b.axis_labels}},d3phylum.components.axis=function(){var a={ticks:10},b=function(b){var c=a.scale.ticks(10),d=d3.svg.axis().orient(a.orient).scale(a.scale).ticks(a.ticks).tickFormat(function(a){return-1!==c.indexOf(a)?a:""});b.call(d);var e=a.scale.range(),f=Math.abs(e[0]-e[1]);switch(a.orient){case"top":b.append("text").attr("class","d3p-label").attr("x",f).attr("y",13).attr("text-anchor","end").text(a.label);break;case"right":b.append("text").attr("class","d3p-label").attr("y",-7).attr("transform","rotate(-90)").attr("text-anchor","end").text(a.label);break;case"bottom":b.append("text").attr("class","d3p-label").attr("x",f).attr("y",-7).attr("text-anchor","end").text(a.label);break;case"left":b.append("text").attr("class","d3p-label").attr("y",14).attr("transform","rotate(-90)").attr("text-anchor","end").text(a.label)}};return b.orient=function(c){return arguments.length?(a.orient=c,b):a.orient},b.scale=function(c){return arguments.length?(a.scale=c,b):a.scale},b.label=function(c){return arguments.length?(a.label=c,b):a.label},b.ticks=function(c){return arguments.length?(a.ticks=c,b):a.scale.ticks(a.ticks)},b},d3phylum.components.legendGuide=function(){var a={keys:[],fill_opacity:.4},b=function(b){var c=b.selectAll("div.d3p-legend").data(a.keys).enter().append("div").attr("class","d3p-legend");c.append("div").attr("class","d3p-legend-color-code").style("background-color",function(b){var c=d3phylum.utils.hexToRgb(a.color_scale(b));return"rgba("+[c.r,c.g,c.b,a.fill_opacity].join(",")+")"}).style("border",function(b){return"1px solid "+a.color_scale(b)}).on("click",function(b){var c=d3.select(this.closest(".d3p-legend"));a.on_click_callback(b,c)}),c.append("span").attr("class","d3p-legend-text").text(function(a){return a})};return b.colorScale=function(c){return arguments.length?(a.color_scale=c,b):a.color_scale},b.keys=function(c){return arguments.length?(a.keys=c,b):a.keys},b.fillOpacity=function(c){return arguments.length?(a.fill_opacity=c,b):a.fill_opacity},b.onClick=function(c){return arguments.length?(a.on_click_callback=c,b):a.on_click_callback},b},d3phylum.components.tooltip=function(){var a={},b=d3.select("div.d3p-tooltip");b.remove();var b=d3.select("body").append("div").attr("class","d3p-tooltip").style("opacity",0);d3phylum._visuals.tooltip=b;var c=function(b){b.on("mouseover",function(b){d3phylum._visuals.tooltip.transition().duration(200).style("opacity",1),d3phylum._visuals.tooltip.html(a.html_content_func(b)).style("left",d3.event.pageX+14+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(a){d3phylum._visuals.tooltip.transition().duration(200).style("opacity",0)})};return c.htmlContent=function(b){return a.html_content_func=b,c},c},d3phylum.visuals.scatterBubblePlot=function(){var a={},b={margin:{top:20,right:20,bottom:20,left:40},cushion:{x:.1,y:.1},axis_labels:{x:"x",y:"y"},bubble_opacity:{fill:.4},legend_disable_opacity:.3,masked_groups:[]};b.width=720-b.margin.right-b.margin.left,b.height=480-b.margin.top-b.margin.bottom;var c=function(){b.x_scale=d3.scale.linear().range([0,b.width]),b.y_scale=d3.scale.linear().range([b.height,0]),b.group_color_scale=d3.scale.category10()},d=function(){a.parent_selection.selectAll("*").remove(),a.svg_plot=a.parent_selection.append("svg").attr("class","d3p-plot").attr("width",b.width+b.margin.left+b.margin.right).attr("height",b.height+b.margin.top+b.margin.bottom),a.tooltip=d3.select("body").append("div").attr("class","d3p-tooltip").style("opacity",0),a.control_widgets=a.parent_selection.append("div").attr("class","d3p-control-widgets").style({"margin-top":"17px","margin-right":b.margin.right+"px","margin-bottom":"17px","margin-left":b.margin.left+"px",display:"inline-block",width:b.width+"px"})},e=function(a){b.bubbles=a;var c=d3.extent(b.bubbles,function(a){return a.x}),d=d3.extent(b.bubbles,function(a){return a.y});b.x_scale.domain(d3phylum.utils.getCushionedDomainForExtent(c,b.cushion.x)),b.y_scale.domain(d3phylum.utils.getCushionedDomainForExtent(d,b.cushion.y))},f=function(a){return-1!==b.masked_groups.indexOf(a)},g=function(){var a=b.source_bubbles.filter(function(a){return!f(a.group)});e(a)},h=function(a){-1===b.masked_groups.indexOf(a)&&b.masked_groups.push(a),g()},i=function(a){var c=b.masked_groups.indexOf(a);-1!==c&&b.masked_groups.splice(c,1),g()},j=function(){a.svg_plot.selectAll("*").remove();var c=d3phylum.components.axis().scale(b.x_scale).orient("bottom").label(b.axis_labels.x);a.svg_plot.append("g").attr("class","d3p-x d3p-axis").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.height+b.margin.top)).call(c);var d=d3phylum.components.axis().scale(b.y_scale).orient("left").label(b.axis_labels.y);a.svg_plot.append("g").attr("class","d3p-y d3p-axis").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.margin.top)).call(d);var e=a.svg_plot.append("g").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.margin.top)).attr("class","d3p-plot-field");e.selectAll(".d3p-dots").data(b.bubbles).enter().append("circle").attr({"class":"d3p-dot",cx:function(a){return b.x_scale(a.x)},cy:function(a){return b.y_scale(a.y)}}).attr("r",function(a){return a.size||3}).style("fill",function(a){return b.group_color_scale(a.group)}).style("fill-opacity",b.bubble_opacity.fill).style("stroke",function(a){return b.group_color_scale(a.group)}).on("mouseover",function(c){d3.select(this).style("fill-opacity",1),a.tooltip.transition().duration(200).style("opacity",1),a.tooltip.html("{{group}}<br/>{{x-axis-label}} - {{x}}<br/>{{y-axis-label}} - {{y}}".replace(/{{group}}/g,c.group).replace(/{{x-axis-label}}/g,b.axis_labels.x).replace(/{{y-axis-label}}/g,b.axis_labels.y).replace(/{{x}}/g,c.x).replace(/{{y}}/g,c.y)).style("left",d3.event.pageX+14+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(c){d3.select(this).style("fill-opacity",b.bubble_opacity.fill),a.tooltip.transition().duration(200).style("opacity",0)})},k=function(){var c=d3phylum.components.legendGuide().colorScale(b.group_color_scale).keys(b.group_color_scale.domain()).fillOpacity(b.bubble_opacity.fill).onClick(function(a,c){f(a)?(c.style("opacity",1),i(a)):(c.style("opacity",b.legend_disable_opacity),h(a)),j()});a.control_widgets.append("div").attr("class","d3p-legend-guide").call(c)},l=function(f){a.parent_selection=f,c(),d(),b.source(function(a,c){b.source_bubbles=c,e(c),j(),k()})};return d3phylum.visuals.baseChart(l,b),l},d3phylum.visuals.distributionGrid=function(){const a="##all_groups##";var b={margin:{top:20,right:20,bottom:60,left:80},group_to_show:a},c={},d={width:600,height:580,x_ticks:20,y_ticks:20,x_axis_label:"x",y_axis_label:"y",gradience_scale_type:"linear",grid_cell_rgb:{r:70,g:30,b:180}},e=function(){b.x_scale=d3.scale.linear().range([0,d.width-b.margin.left-b.margin.right]),b.y_scale=d3.scale.linear().range([d.height-b.margin.top-b.margin.bottom,0])},f=function(){c.parent_selection.selectAll("*").remove(),c.svg_plot=c.parent_selection.append("svg").attr({"class":"d3p-plot",width:d.width,height:d.height}),c.control_widgets=c.parent_selection.append("div").attr("class","d3p-control-widgets").style({"margin-top":"17px","margin-right":b.margin.right+"px","margin-bottom":"17px","margin-left":b.margin.left+"px",display:"inline-block",width:d.width+"px"})},g=function(a){b.source_points=a.points,b.points=b.source_points;var c=d3.extent(b.source_points,function(a){return a.x}),d=d3.extent(b.source_points,function(a){return a.y}),e=d3phylum.utils.getCushionedDomainForExtent(c,.1),f=d3phylum.utils.getCushionedDomainForExtent(d,.1);b.x_scale.domain(e),b.y_scale.domain(f)},h=function(){var a=d3phylum.components.axis().orient("bottom").scale(b.x_scale).label(d.x_axis_label).ticks(d.x_ticks);c.svg_plot.append("g").attr("class","d3p-x d3p-axis").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,d.height-b.margin.bottom)).call(a);var e=d3phylum.components.axis().orient("left").scale(b.y_scale).label(d.y_axis_label).ticks(d.y_ticks);c.svg_plot.append("g").attr("class","d3p-y d3p-axis").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.margin.top)).call(e)},i=function(){c.grid=c.svg_plot.append("g").attr("class","d3p-grid").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.margin.top));var a=b.x_scale.ticks(d.x_ticks),e=b.y_scale.ticks(d.y_ticks);b.grid_cell_width=parseInt(b.x_scale(a[1])-b.x_scale(a[0])),b.grid_cell_height=parseInt(b.y_scale(e[0])-b.y_scale(e[1])),c.grid.selectAll(".d3p-v-gridline").data(b.x_scale.ticks(d.x_ticks)).enter().append("line").attr("class","d3p-v-gridline").attr("x1",b.x_scale).attr("y1",0).attr("x2",b.x_scale).attr("y2",d.height-b.margin.top-b.margin.bottom),c.grid.selectAll(".d3p-h-gridline").data(b.y_scale.ticks(d.y_ticks)).enter().append("line").attr("class","d3p-h-gridline").attr("x1",0).attr("y1",b.y_scale).attr("x2",d.width-b.margin.left-b.margin.right).attr("y2",b.y_scale)},j=function(){var a=d3.scale.quantize().domain(b.x_scale.domain()).range(b.x_scale.ticks(d.x_ticks)),c=d3.scale.quantize().domain(b.y_scale.domain()).range(b.y_scale.ticks(d.y_ticks)),e={};return b.points.forEach(function(b){var d=a(b.x),f=c(b.y),g=JSON.stringify({x:d,y:f});grid_datum=e[g]||{x:d,y:f,count:0},grid_datum.count+=1,e[g]=grid_datum}),Object.keys(e).map(function(a){return e[a]})},k=function(a){var b,c=d3.extent(a,function(a){return a.count});return"log"===d.gradience_scale_type?(c[0]+=1,c[1]+=1,b=d3.scale.log().domain(c).range([.06,1]),function(a){return b(a+1)}):"linear"===d.gradience_scale_type?(b=d3.scale.linear().domain(c).range([.06,1]),function(a){return b(a)}):void 0},l=function(){b.grid_data=j();var a=k(b.grid_data),e=b.grid_cell_width/2,f=b.grid_cell_height/2,g=d3phylum.components.tooltip();g.htmlContent(function(a){return d3phylum.utils.strSubstitute("{{x_label}}: {{x}}<br/>{{y_label}}: {{y}}<br/>Count: {{count}}",{"{{x_label}}":d.x_axis_label,"{{y_label}}":d.y_axis_label,"{{x}}":a.x,"{{y}}":a.y,"{{count}}":a.count})}),c.grid.selectAll(".d3p-gridcell").data(b.grid_data).enter().append("circle").attr("cx",function(a){return b.x_scale(a.x)}).attr("cy",function(a){return b.y_scale(a.y)}).attr("r",d3.min([e,f])).style("fill",function(b){var c=d.grid_cell_rgb;return d3phylum.utils.rgbaStr(c.r,c.g,c.b,a(b.count))}).call(g)},m=function(a){var c={};return b.grid_data.forEach(function(b){var d=c[b[a]];d||(d={count:0},d[a]=b[a]),d.count+=b.count,c[b[a]]=d}),Object.keys(c).map(function(a){return c[a]})},n=function(){var a=d.grid_cell_rgb;b.x_summary_counts=m("x"),b.y_summary_counts=m("y");var e=k(b.x_summary_counts),f=k(b.y_summary_counts),g=d3phylum.components.tooltip();g.htmlContent(function(a){return d3phylum.utils.strSubstitute("{{x_label}}: {{x}}<br /> Count: {{count}}",{"{{x_label}}":d.x_axis_label,"{{x}}":a.x,"{{count}}":a.count})});var h=d3phylum.components.tooltip();h.htmlContent(function(a){return d3phylum.utils.strSubstitute("{{y_label}}: {{y}}<br /> Count: {{count}}",{"{{y_label}}":d.y_axis_label,"{{y}}":a.y,"{{count}}":a.count})}),c.x_summary_counts=c.svg_plot.append("g").attr("class","d3p-x-summary-counts").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,d.height-30)),c.x_summary_counts.selectAll(".d3p-x-summary-count-cell").data(b.x_summary_counts).enter().append("rect").attr("x",function(a){return b.x_scale(a.x)-b.grid_cell_width/2}).attr("y",0).attr("width",b.grid_cell_width).attr("height",30).style("fill",function(b){return d3phylum.utils.rgbaStr(a.r,a.g,a.b,e(b.count))}).call(g),c.y_summary_counts=c.svg_plot.append("g").attr("class","d3p-y-summary-counts").attr("transform",d3phylum.utils.svgTranslate(0,b.margin.top)),c.y_summary_counts.selectAll(".d3p-y-summary-count-cell").data(b.y_summary_counts).enter().append("rect").attr("x",0).attr("y",function(a){return b.y_scale(a.y)-b.grid_cell_height/2}).attr("width",30).attr("height",b.grid_cell_height).style("fill",function(b){return d3phylum.utils.rgbaStr(a.r,a.g,a.b,f(b.count))}).call(h)},o=function(){c.svg_plot.selectAll("*").remove(),b.group_to_show!==a?b.points=b.source_points.filter(function(a){return b.group_to_show===a.group}):b.points=b.source_points,i(),h(),l(),n()},p=function(){var a=c.control_widgets.append("div").attr("class","d3p-scale-type-selection-widget").text("Gradience scale type:").selectAll('input[type="radio"]').data(["linear","log"]).enter().append("label").append("span").attr("class","d3p-input-radio-wrapper");a.append("input").attr("checked",function(a){return a===d.gradience_scale_type?"checked":null}).attr("type","radio").attr("name","d3p-scale-type-option").attr("value",function(a){return a}).on("click",function(a){d.gradience_scale_type=a,o()}),a.append("span").text(function(a){return a})},q=function(){c.control_widgets.append("div").attr("class","d3p-distribution-grid-zoom-widget").text("Distribution grid ticks:").selectAll("a.d3p-distribution-grid-zoom-option").data([5,10,20,50,100]).enter().append("a").attr("href","#").attr("class","d3p-distribution-grid-zoom-option").text(function(a){return a}).on("click",function(a){d.x_ticks=a,d.y_ticks=a,o()})},r=function(){var d=d3.map(b.source_points,function(a){return a.group}).keys(),e=c.control_widgets.append("div").attr("class","d3p-group-selection-widget").text("Distribution by group:").selectAll('input[type="radio"]').data(d.concat([a])).enter().append("label").append("span").attr("class","d3p-input-radio-wrapper");e.append("input").attr("type","radio").attr("name","d3p-group-select-option").attr("value",function(a){return a}).on("click",function(a){b.group_to_show=a,o()}),e.append("span").text(function(b){return b===a?"All":b})},s=function(){c.control_widgets.selectAll("*").remove(),p(),q(),r()},t=function(a){c.parent_selection=a,e(),f(),d.source(function(a,b){g(b),o(),s()})};return t.width=function(a){return arguments.length?(d.width=a,t):d.width},t.height=function(a){return arguments.length?(d.height=a,t):d.height},t.source=function(a){return d.source=a,t},t.axisTicks=function(a){return arguments.length?(d.x_ticks=a.x,d.y_ticks=a.y,t):{x:d.x_ticks,y:d.y_ticks}},t.axisLabels=function(a){return arguments.length?(d.x_axis_label=a.x,d.y_axis_label=a.y,t):{x:d.x_axis_label,y:d.y_axis_label}},t.gradienceScaleType=function(a){return arguments.length?(d.gradience_scale_type=a,t):d.gradience_scale_type},t.cellColor=function(a){if(!arguments.length){var b=d.grid_cell_rgb;return d3phylum.utils.rgbToHex(b.r,b.g,b.b)}return d.grid_cell_rgb=d3phylum.utils.hexToRgb(a),t},t};