this.d3phylum={visuals:{},components:{},utils:{}},d3phylum.utils={svgTranslate:function(a,b){return"translate("+a+","+b+")"},getCushionedDomainForExtent:function(a,b){var c=a[1]-a[0];c+=2*c*b;var d=c*b;return[a[0]-d,a[1]+d]},hexToRgb:function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null}},d3phylum.visuals.baseChart=function(a,b){a.width=function(c){return arguments.length?(b.width=c,b.margin&&(b.width-=b.margin.left,b.width-=b.margin.right),a):b.width},a.height=function(c){return arguments.length?(b.height=c,b.margin&&(b.height-=b.margin.top||0,b.height-=b.margin.bottom||0),a):b.height},a.source=function(c){return b.source=c,a},a.axisLabels=function(c){return arguments.length?(b.axis_labels=c,a):b.axis_labels}},d3phylum.components.axis=function(){var a={},b=function(b){var c=d3.svg.axis().orient(a.orient).scale(a.scale);b.call(c);var d=a.scale.range(),e=Math.abs(d[0]-d[1]);switch(a.orient){case"top":b.append("text").attr("class","label").attr("x",e).attr("y",13).attr("text-anchor","end").text(a.label);break;case"right":b.append("text").attr("class","label").attr("y",-7).attr("transform","rotate(-90)").attr("text-anchor","end").text(a.label);break;case"bottom":b.append("text").attr("class","label").attr("x",e).attr("y",-7).attr("text-anchor","end").text(a.label);break;case"left":b.append("text").attr("class","label").attr("y",14).attr("transform","rotate(-90)").attr("text-anchor","end").text(a.label)}};return b.orient=function(c){return arguments.length?(a.orient=c,b):a.orient},b.scale=function(c){return arguments.length?(a.scale=c,b):a.scale},b.label=function(c){return arguments.length?(a.label=c,b):a.label},b},d3phylum.components.legendGuide=function(){var a={keys:[],fill_opacity:.4},b=function(b){var c=b.selectAll("div.legend").data(a.keys).enter().append("div").attr("class","legend");c.append("div").attr("class","legend-color-code").style("background-color",function(b){var c=d3phylum.utils.hexToRgb(a.color_scale(b));return"rgba("+[c.r,c.g,c.b,a.fill_opacity].join(",")+")"}).style("border",function(b){return"1px solid "+a.color_scale(b)}).on("click",function(b){var c=d3.select(this.closest(".legend"));a.on_click_callback(b,c)}),c.append("span").attr("class","legend-text").text(function(a){return a})};return b.colorScale=function(c){return arguments.length?(a.color_scale=c,b):a.color_scale},b.keys=function(c){return arguments.length?(a.keys=c,b):a.keys},b.fillOpacity=function(c){return arguments.length?(a.fill_opacity=c,b):a.fill_opacity},b.onClick=function(c){return arguments.length?(a.on_click_callback=c,b):a.on_click_callback},b},d3phylum.visuals.scatterBubblePlot=function(){var a={},b={margin:{top:20,right:20,bottom:20,left:40},cushion:{x:.1,y:.1},axis_labels:{x:"x",y:"y"},bubble_opacity:{fill:.4},legend_disable_opacity:.3,masked_groups:[]};b.width=720-b.margin.right-b.margin.left,b.height=480-b.margin.top-b.margin.bottom;var c=function(){b.x_scale=d3.scale.linear().range([0,b.width]),b.y_scale=d3.scale.linear().range([b.height,0]),b.group_color_scale=d3.scale.category10()},d=function(){a.parent_selection.selectAll("*").remove(),a.svg_plot=a.parent_selection.append("svg").attr("class","plot").attr("width",b.width+b.margin.left+b.margin.right).attr("height",b.height+b.margin.top+b.margin.bottom),a.tooltip=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),a.control_widgets=a.parent_selection.append("div").attr("class","control-widgets").style({"margin-top":"17px","margin-right":b.margin.right+"px","margin-bottom":"17px","margin-left":b.margin.left+"px",display:"inline-block",width:b.width+"px"})},e=function(a){b.bubbles=a;var c=d3.extent(b.bubbles,function(a){return a.x}),d=d3.extent(b.bubbles,function(a){return a.y});b.x_scale.domain(d3phylum.utils.getCushionedDomainForExtent(c,b.cushion.x)),b.y_scale.domain(d3phylum.utils.getCushionedDomainForExtent(d,b.cushion.y))},f=function(a){return-1!==b.masked_groups.indexOf(a)},g=function(){var a=b.source_bubbles.filter(function(a){return!f(a.group)});e(a)},h=function(a){-1===b.masked_groups.indexOf(a)&&b.masked_groups.push(a),g()},i=function(a){var c=b.masked_groups.indexOf(a);-1!==c&&b.masked_groups.splice(c,1),g()},j=function(){a.svg_plot.selectAll("*").remove();var c=d3phylum.components.axis().scale(b.x_scale).orient("bottom").label(b.axis_labels.x);a.svg_plot.append("g").attr("class","x axis").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.height+b.margin.top)).call(c);var d=d3phylum.components.axis().scale(b.y_scale).orient("left").label(b.axis_labels.y);a.svg_plot.append("g").attr("class","y axis").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.margin.top)).call(d);var e=a.svg_plot.append("g").attr("transform",d3phylum.utils.svgTranslate(b.margin.left,b.margin.top)).attr("class","plot-field");e.selectAll(".dots").data(b.bubbles).enter().append("circle").attr({"class":"dot",cx:function(a){return b.x_scale(a.x)},cy:function(a){return b.y_scale(a.y)}}).attr("r",function(a){return a.size||3}).style("fill",function(a){return b.group_color_scale(a.group)}).style("fill-opacity",b.bubble_opacity.fill).style("stroke",function(a){return b.group_color_scale(a.group)}).on("mouseover",function(c){d3.select(this).style("fill-opacity",1),a.tooltip.transition().duration(200).style("opacity",1),a.tooltip.html("{{group}}<br/>{{x-axis-label}} - {{x}}<br/>{{y-axis-label}} - {{y}}".replace(/{{group}}/g,c.group).replace(/{{x-axis-label}}/g,b.axis_labels.x).replace(/{{y-axis-label}}/g,b.axis_labels.y).replace(/{{x}}/g,c.x).replace(/{{y}}/g,c.y)).style("left",d3.event.pageX+14+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(c){d3.select(this).style("fill-opacity",b.bubble_opacity.fill),a.tooltip.transition().duration(200).style("opacity",0)})},k=function(){var c=d3phylum.components.legendGuide().colorScale(b.group_color_scale).keys(b.group_color_scale.domain()).fillOpacity(b.bubble_opacity.fill).onClick(function(a,c){f(a)?(c.style("opacity",1),i(a)):(c.style("opacity",b.legend_disable_opacity),h(a)),j()});a.control_widgets.append("div").attr("class","legend-guide").call(c)},l=function(f){a.parent_selection=f,c(),d(),b.source(function(a,c){b.source_bubbles=c,e(c),j(),k()})};return d3phylum.visuals.baseChart(l,b),l};